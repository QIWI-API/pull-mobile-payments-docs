---
title: Mobile payments API Mobile commerce

search: true

metatitle: Mobile payments API Mobile commerce

metadescription: Mobile payments API Mobile commerce provides access to operations with customer's mobile account of a mobile network operator from your application. API supports initiating payment for invoice from mobile network operator, as well as requesting operation statuses.

language_tabs:
  - shell
  - php

services:
 - <a href='#'>Swagger</a>  |  <a href='#'>Qiwi Demo</a>


toc_footers:
 - <a href='/en/'>Home page</a>

includes:
  - pull-payments/notification_en

---

# Payments From Mobile Account

###### Last update: 2019-10-05 | [Edit on GitHub](https://github.com/QIWI-API/pull-payments-docs/blob/master/pull-mobile-payments_en.html.md)

Mobile payments API provides access to operations with customer's mobile account from your application or service. The following operations are supported:

* Payment initiation
* Checking invoice payment status
* Payment notifications


## Customer Order Payment Flow {#steps}

Payment flow processes as follows:

<img id='mobile' src="/images/mobile.png" class="image" />

1. The customer puts an order on the merchant's site.
2. Merchant makes [Initiate Payment](#invoice_rest) request with the authorization parameters.
3. Customer receives SMS from their mobile network operator immediately on initiating payment. SMS contains the information about corresponding payment invoice.
4. Customer approves payment by the response SMS. The invoice is automatically rejected when customer rejects the payment.

   ![Mobile SMS](/images/pull_mobile.jpg){:height="45%" width="45%"}

4. If the merchant enables [notifications to merchant's server](#notification_en), then QIWI system sends a notification (web-hook) of the invoice payment to the merchant's server once invoice is paid. Authorization on the merchant's side is required for notifications.

   If merchant does not use notifications, they can [request current payment status](#invoice-status) of the invoice.

5.  When the invoice payment is confirmed, merchant delivers ordered services/goods.

**To use API, complete [registration and approval of the agreement](https://kassa.qiwi.com).**


## Authorization {#auth_param}

Mobile payments API requests are authorized through HTTP Basic-authorization with [API ID and API password](#auth_param) Header is `Authorization` string and its value is `Basic Base64(API_ID:API_PASSWORD)`.

~~~shell
user@server:~$ curl "server_address"
  --header "Authorization: Basic MjMyNDQxMjM6NDUzRmRnZDQ0Mw=="
~~~

<ul class="nestedList params">
    <li><h3>Authorization and forms</h3><span>You can obtain the data on <a href="https://kassa.qiwi.com">kassa.qiwi.com</a> site</span>
    </li>
</ul>

### Service data {#auth_param}

Parameter|Description|Type|Required
 ---------|--------|---|------
 API_ID | Provider API identifier for authorization | Integer| +
 API_PASSWORD | API password for authorization| String | +
 Shop ID | Numeric identifier of the provider's service | Integer | +

<aside class="notice">
To obtain service data, open "Protocols - REST - Authorization" section on <a href='http://kassa.qiwi.com'>kassa.qiwi.com</a>

<ul class="nestedList notice_image">
    <li><h3>Details</h3>
        <ul>
             <li><img src="/images/pull_rest_auth_kassa.png" /></li>
        </ul>
    </li>
</ul>

</aside>

## Payment Initiation {#invoice_rest}

The request initiates a new payment for a specified mobile phone number. Request type - HTTP PUT.

To confirm payment, customer's mobile network operator send SMS with code to the specified phone number.

<h3 class="request method">Request → PUT</h3>

~~~shell
user@server:~$ curl "https://api.qiwi.com/api/v2/prv/373712/bills/BILL-1"
  -X PUT --header "Accept: text/json"
  --header "Authorization: Basic ***"
  -d 'user=tel%3A%2B79161111111&amount=10.00&ccy=RUB&comment=test&pay_source=mobile&lifetime=2016-09-25T15:00:00'
~~~

~~~http
HTTP/1.1 200 OK
Content-Type: text/json

{
  "response": {
     "result_code": 0,
     "bill": {
        "bill_id": "BILL-1",
        "amount": "10.00",
        "ccy": "RUB",
        "status": "waiting",
        "error": 0,
        "user": "tel:+79161111111",
        "comment": "test"
     }
  }
}
~~~

<ul class="nestedList url">
    <li><h3>URL <span>https://api.qiwi.com/api/v2/prv/<a>prv_id</a>/bills/<a>bill_id</a></span></h3>
        <ul>
        <strong>Parameters are in the PUT-request URL pathname:</strong>
             <li><strong>prv_id</strong> - merchant’s Shop ID (numeric value, as displayed in "ID" parameter of "Protocols Settings" section of kassa.qiwi.com web site)</li>
             <li><strong>bill_id</strong> - unique invoice identifier generated by the merchant (any non-empty string of up to 200 characters). Uniqueness means that the identifier must not coincide with any of previously issued invoices of the merchant.</li>
        </ul>
    </li>
</ul>

<ul class="nestedList header">
    <li><h3>HEADERS</h3>
        <ul>
             <li>Accept: text/json or Accept: application/json - JSON response</li>
             <li>Content-type: application/x-www-form-urlencoded; charset=utf-8</li>
             <li>Authorization: Basic ***</li>
        </ul>
    </li>
</ul>

<ul class="nestedList params">
<li><h3>Parameters</h3><span>Parameters are sent in the request body as url-encoded <i>formdata</i>.</span>
</li>
</ul>

Parameter|Description|Type|Required
---------|--------|---|------
user | The QIWI Wallet user’s ID, to whom the invoice is issued. It is the user’s phone number with `tel:` prefix | String(20)|Y
amount | The invoice amount. The number is rounded down with two decimal places | Number(6.2)|Y
ccy | Invoice currency identifier (Alpha-3 ISO 4217 code). Depends on currencies allowed for the merchant in QIWI system | String(3)|Y
comment | Comment to the invoice | String(255)|Y
lifetime | Date and time up to which the invoice is available for payment, URL-encoded ISO 8601 (`YYYY-MM-DDThh:mm:ss`), Moscow timezone. If the invoice is not paid by this date it will become void and will be assigned a final status.<br> **Important! Invoice will be automatically expired when 45 days is passed after the invoicing date**|dateTime|Y
pay_source |`mobile`  - the customer's MNO balance will be used as a funding source for the payment| String|Y

The given PHP example implements creation of the invoice. This example demonstrates using merchant's [authorization parameters](#auth_param), i.e. shop ID, API ID and password for the API ID. Open the _PHP_ tab on the right.

<h3 class="request">Response ←</h3>

> Successful response

~~~http
HTTP/1.1 200 OK

Content-Type: text/json;charset=utf-8
{
  "response": {
     "result_code": 0,
     "bill": {
        "bill_id": "BILL-1",
        "amount": "10.00",
        "ccy": "RUB",
        "status": "waiting",
        "error": 0,
        "user": "tel:+79031234567",
        "comment": "test"
     }
  }
}
~~~

> Error Response

~~~http
HTTP/1.1 500 Internal Server Error
Content-Type: text/json;charset=utf-8

{
 "response": {
  "result_code": 150,
  "description": "Authorization failed"
  }
}
~~~

<ul class="nestedList params">
    <li><a href="#parameters"><h3>Parameters</h3></a>
    </li>
</ul>

Parameter|Type|Description
--------|---|--------
result_code|Integer|[Error code](#errors)
description|String|Error description. Returned when `result_code` is non-zero.
bill|Object|Bill data. Returned when `result_code` is zero (successful operation). Parameters:
bill.bill_id|String|Unique invoice identifier generated by the merchant
bill.amount|String|The invoice amount. The number is rounded down with two decimal places.
bill.ccy|String|Currency identifier of the invoice (Alpha-3 ISO 4217 code)
bill.status|String|Current [invoice status](#status)
bill.error|Integer|Always `0`, means successful operation
bill.user|String|The QIWI Wallet user’s ID, to whom the invoice is issued. It is the user’s phone number with `tel:` prefix.
bill.comment|String|Comment to the invoice

~~~php

<?php
//PHP implementation of invoice creation
//Shop identifier
$SHOP_ID = "21379721";
//API ID
$REST_ID = "62573819";
//API Password
$PWD = "**********";
//Invoice ID
$BILL_ID = "99111-ABCD-1-2-1";
$PHONE = "79191234567";

$data = array(
    "user" => "tel:+" . $PHONE,
    "amount" => "1000.00",
    "ccy" => "RUB",
    "comment" => "All good",
    "lifetime" => "2015-01-30T15:35:00",
    "pay_source" => "mobile"
);

$ch = curl_init('https://api.qiwi.com/api/v2/prv/'.$SHOP_ID.'/bills/'.$BILL_ID);
curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, FALSE);
curl_setopt($ch, CURLOPT_CUSTOMREQUEST, 'PUT');
curl_setopt($ch, CURLOPT_POSTFIELDS, http_build_query($data));
curl_setopt($ch, CURLOPT_POST, 1);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE);
curl_setopt($ch, CURLOPT_HTTPAUTH, CURLAUTH_BASIC);
curl_setopt($ch, CURLOPT_USERPWD, $REST_ID.":".$PWD);
curl_setopt($ch, CURLOPT_HTTPHEADER,array (
    "Accept: application/json"
));
$results = curl_exec ($ch) or die(curl_error($ch));
echo $results;
echo curl_error($ch);
curl_close ($ch);
?>
~~~

## Checking Payment Status {#invoice-status}

Using this request you can get current payment status of the invoice.


~~~shell
user@server:~$ curl "https://api.qiwi.com/api/v2/prv/373712/bills/sdf23452435"
  --header "Authorization: Basic ***" --header "Accept: text/json"
~~~

<h3 class="request method">Request → GET</h3>

<ul class="nestedList url">
    <li><h3>URL <span>https://api.qiwi.com/api/v2/prv/<a>prv_id</a>/bills/<a>bill_id</a></span></h3>
        <ul>
        <strong>Parameters are in the GET-request URL pathname:</strong>
             <li><strong>prv_id</strong> - merchant’s Shop ID (numeric value, as displayed in "Shop ID" parameter of "Protocols Settings" section of kassa.qiwi.com web site)</li>
             <li><strong>bill_id</strong> - invoice identifier</li>
        </ul>
    </li>
</ul>

<ul class="nestedList header">
    <li><h3>HEADERS</h3>
        <ul>
             <li>Accept: text/json or Accept: application/json - JSON response</li>
             <li>Authorization: Basic ***</li>
        </ul>
    </li>
</ul>

<h3 class="request">Response ←</h3>

> Successful Response

~~~http
HTTP/1.1 200 OK
Content-Type: text/json

{
  "response": {
     "result_code": 0,
     "bill": {
        "bill_id": "BILL-1",
        "amount": "10.00",
        "originAmount": "10.00"
        "ccy": "RUB",
        "originCcy": "RUB",
        "status": "paid",
        "error": 0,
        "user": "tel:+79031234567",
        "comment": "test"
     }
  }
}
~~~

> Error response

~~~http
HTTP/1.1 500 Internal Server Error
Content-Type: text/json

{
 "response": {
  "result_code": 150,
  "description": "Authorization failed"
  }
}
~~~

<ul class="nestedList params">
    <li><h3>Parameters</h3>
    </li>
</ul>

Parameter|Type|Description
--------|---|--------
result_code|Integer|[Error code](#errors)
description|String|Error description. Returned when `result_code` is non-zero.
bill|Object|Bill data. Returned when `result_code` is zero (successful operation). Parameters:
bill.bill_id|String|Unique invoice identifier generated by the merchant
bill.amount|String|The invoice amount. The number is rounded down with two decimal places.
bill.originAmount|String|The amount taken from the balance when the invoice get paid (see `originCcy` parameter). The number is rounded down with two decimal places. **Returns for invoices when the user initiates payment**.
bill.ccy|String|Currency identifier of the invoice (Alpha-3 ISO 4217 code)
bill.originCcy|String|Currency identifier of the balance from which the invoice is paid (Alpha-3 ISO 4217 code). **Returns for invoices when the user initiates payment**.
bill.status|String|Current [invoice status](#status)
bill.error|Integer|Always `0`, means successful operation
bill.user|String|The QIWI Wallet user’s ID, to whom the invoice is issued. It is the user’s phone number with `tel:` prefix.
bill.comment|String|Comment to the invoice

## Operation Statuses {#status}

### Payment Status {#status_bills}

Status|Description|Final
------|--------|---------
waiting | Payment initiating, pending payment| N
paid| paid|Y
rejected| rejected|Y
unpaid|Payment processing error. Not paid|Y
expired |Payment expired. Not paid|Y

## Error Codes {#errors}

Code| Description |[Fatal](#fatal)
---|----------|------
0|Success   | Unrelated
5|Incorrect data in the request parameters|Y
13|Server is busy, try again later|N
78|Operation is forbidden|Y
150|Authorization error (e.g. invalid login/password)|Y
152|Protocol is not enabled or protocol is disabled|N
155|This merchant’s identifier ([API ID](#auth)) is blocked|Y
210|Invoice not found|Y
215|Invoice with this `bill_id` already exists|Y
241|Invoice amount is less than allowed|Y
242|Invoice amount is greater than allowed. Also returns to refund request when the amount of refund exceeds the initial invoice amount or the amount left after the previous refunds | Y
298|User not registered|Y
300|Technical error|N
303|Wrong phone number|Y
316|Authorization from the blocked merchant|N
319|No rights for the operation|N
339|IP-addresses blocked|Y
341|Required parameter is incorrectly specified or absent in the request|Y
700|Monthly limit on operations is exceeded|Y
774|QIWI Wallet user account temporarily blocked<a name="fatal"></a>|Y
1001|Currency is not allowed for the merchant|Y
1003|No convert rate for these currencies|N
1019|Unable to determine wireless operator for MNO balance payment|Y
1419|Bill was already payed|Y

<aside class="notice"><b>Fatal</b> means the result will not change with the second and subsequent requests (error is not temporary)</aside>
